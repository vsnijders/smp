<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>StatMine</title>

    <!-- webpage icon -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="images/favicon2.png" type="image/png" />

    <!-- jQuery includes -->
    <script type="text/javascript" src="js/jquery/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="js/jquery/jquery.getUrlParam.js"></script>
    <script type="text/javascript" src="js/R.js"></script>


    <!-- localization includes -->
    <script type="text/javascript" src="js/i18next.js"></script>
    <script type="text/javascript" src="js/mustache/mustache.js"></script>
    <script type="text/javascript" src="js/markdown/markdown.js"></script>

    <!-- bootstrap includes -->
    <link type="text/css" href="js/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <script type="text/javascript" src="js/bootstrap/js/bootstrap.min.js"></script>

    <!-- styling -->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,300italic,400' rel='stylesheet' type='text/css'/>
    <link type="text/css" href="css/statmine.css" rel="stylesheet" />
    <link type="text/css" href="css/table.css" rel="stylesheet" />

    <!-- scripting -->
    <script type="text/javascript">

      $(function() {

        var table = $(document).getUrlParam("table");
        R.get_meta(table).success(function(meta){
          console.log(meta);
          window.meta= meta;

          var o = { name: meta.name
                  , description: markdown.toHTML(meta.description)
                  , terms: []
                  }
          
          var terms = o.terms;

          //collect terms + descriptions of all meta data objects.
          function addTerm(_, object){
            if (!object.description) return;

            terms.push({ term: object.name
                       , description: markdown.toHTML(object.description)
                       })
          }

          $.each(meta.variables, addTerm)

          $.each(meta.dimensions, function(_, dim){
            addTerm(_,dim);
            $.each(dim.categories, addTerm);
          })

          var $info = $("#info");
          var t = $info.html();
          var tc = Mustache.compile(t);

          $info.html(tc(o));

        });        

        $("a.mode").each(function(_, a){
          a.href += window.location.search;
        })

        i18n.init({}, function(){
          $("body").i18n();
        });


      });
    </script>

  </head>

  <body>
    <header>
      <div class="navbar navbar-static-top navbar-inverse">
      <div class="navbar-inner">
        <a class="brand" href="index.html">StatMine</a>
        <ul class="nav">
          <li><a class="mode" href="visualize.html"><i class="icon-eye-open icon-white"></i> <span data-i18n="view">View</span></a></li>
          <li><a class="mode" href="table.html"><i class="icon-list icon-white"></i> <span data-i18n="table">Table</span></a></li>
          <li><a class="mode" href="link.html"><i class="icon-resize-horizontal icon-white"></i> <span data-i18n="link">Link</span></a></li>
          <li class="active"><a class="mode" href="info.html"><i class="icon-info-sign icon-white"></i> <span data-i18n="info">Info</span></a></li>
        </ul>
        <span class="brand" id="title"/>
      </div>
    </div>
    </header>

   <div class="container-fluid" style="padding-left:0">
    <div class="row-fluid">
      <div class="span8 offset1 well" id="info">
        <h1><span data-i18n="table">Table</span>: '{{name}}'</h1>
        <h3 data-i18n="description">Description</h3>
        {{{description}}}

        <h3 data-i18n="terms">Terms</h3>
        <dl class="dl-horizontal">
          {{#terms}}
          <dt>{{term}}</dt>
          <dd>{{{description}}}</dd>
          {{/terms}}
        </dl>
      </div>
    </div>
   </div>

    <footer>
    </footer>
  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>StatMine</title>

    <!-- webpage icon -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="images/favicon2.png" type="image/png" />

    <!-- jQuery includes -->
    <script type="text/javascript" src="js/jquery/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="js/jquery/jquery.getUrlParam.js"></script>
    <script type="text/javascript" src="js/DataTables/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="js/mustache/mustache.js"></script>
    <script type="text/javascript" src="js/R.js"></script>


    <!-- localization includes -->
    <script type="text/javascript" src="js/i18next.js"></script>

    <!-- bootstrap includes -->
    <link type="text/css" href="js/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <script type="text/javascript" src="js/bootstrap/js/bootstrap.min.js"></script>

    <!-- styling -->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,300italic,400' rel='stylesheet' type='text/css'/>
    <link type="text/css" href="css/statmine.css" rel="stylesheet" />
    <link type="text/css" href="css/table.css" rel="stylesheet" />

    <!-- scripting -->
    <script type="text/javascript">
     
     function transpose(dataframe){
        var init = true;
        var data = [];
        $.each(dataframe, function(name, col){
          if (init){
            init = false;
            for (var i = 0; i < col.length+1; i++){
              data[i] = [];
            }
          }
          //save name
          data[0].push(name);

          for (var i = 0; i < col.length; i++){
            data[i+1].push(col[i]);
          }          
        });
        return data;
     }

     function transpose2(dataframe){
        var init = true;
        var data = [];
        $.each(dataframe, function(name, col){
          if (init){
            init = false;
            for (var i = 0; i < col.length; i++){
              data[i] = {};
            }
          }
          for (var i = 0; i < col.length; i++){
            data[i][name] = col[i];
          }          
        });
        return data;
     }

     $(function() {

        var tablename = $(document).getUrlParam("table");

        R.get_table(tablename).success(function(meta_data ){
          var div   = $("#table");
          var table = $("<table>");
          //table.append("<caption>").text("Hello!");
          table.appendTo(div);

          var data = transpose(meta_data.data);

          var meta = meta_data.meta;
          var colnames = data[0].map( function(n){
            return { sTitle: (meta.dimensions[n] || meta.variables[n] || {name: n}).name
                   , sType: (meta.variables[n])? "numeric" : "string"}
          });
          
          //remove first row
          data.shift(0)

          table.dataTable({
            aaData: data, 
            aoColumns: colnames,
            bScrollInfinite: true,
            sScrollY: "600px",
            bScrollCollapse: true,
            bPaginate: false,
            bDeferRender : true 
          });
        });


        $("a.mode").each(function(_, a){
          a.href += window.location.search;
        })

        i18n.init({}, function(){
          $("body").i18n();
        });


        var test = {size: [2,3], height: [4,5]};
        var res = transpose(test);
        console.log(res, transpose2(test));

      });
    </script>

  </head>

  <body>
    <header>
      <div class="navbar navbar-static-top navbar-inverse">
      <div class="navbar-inner">
        <a class="brand" href="index.html">StatMine</a>
        <ul class="nav">
          <li><a class="mode" href="visualize.html"><i class="icon-eye-open icon-white"></i> <span data-i18n="view">View</span></a></li>
          <li class="active"><a class="mode" href="table.html"><i class="icon-th icon-white"></i> <span data-i18n="table">Table</span></a></li>
          <li><a class="mode" href="link.html"><i class="icon-resize-horizontal icon-white"></i> <span data-i18n="link">Link</span></a></li>
          <li><a class="mode" href="info.html"><i class="icon-info-sign icon-white"></i> <span data-i18n="info">Info</span></a></li>
        </ul>
        <span class="brand" id="title"/>
      </div>
    </div>
    </header>
    <div class="container-fluid" style="padding-left:0">
      <div class="row-fluid">
        <div class="span8 offset1">
          <div id="table"></div> 
        </div>
      </div>
    </div>
    <footer>
    </footer>
  </body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>StatMine</title>

    <!-- webpage icon -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="images/favicon2.png" type="image/png" />

    <!-- jQuery includes -->
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <link type="text/css" href="css/smoothness/jquery-ui-1.9.1.custom.min.css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.getUrlParam.js"></script>
    
	<!-- bootstrap includes -->
    <link type="text/css" href="js/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <script type="text/javascript" src="js/bootstrap/js/bootstrap.min.js"></script>

	
	<script type="text/javascript" src="js/link.js"></script>

    <!-- styling -->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,300italic,400' rel='stylesheet' type='text/css'/>
    <link type="text/css" href="css/statmine.css" rel="stylesheet" />

    <!-- scripting -->
    <script type="text/javascript">
      
      var T1 = null;

      $(function() {

        $("div.draggable")
          .css("cursor", "move")
          .draggable( {axis:"y", revert: "invalid"} )
          ;

        $(".dropable")
          .droppable({
            accept: ".draggable",
            activeClass: "droppable_active", 
            hoverClass: "droppable_hover", 
            tolerance : "touch",
            drop: function(e, dragevent){
              Link.renderCat(e.target, dragevent.draggable)
            }
          });

		  
		data = Link.getData("#link");

        var table1_name = $(document).getUrlParam("table1");
        var table2_name = $(document).getUrlParam("table2");

        jQuery.getJSON("r/gen_link.r", {"table1":table1_name, "table2": table2_name}, 
            function(data) {
              $("#linkdump").text(JSON.stringify(data));

              Link.render("#link2", data)
        });



        jQuery.getJSON("r/get_meta.r", {"table":table1_name}, 
            function(data) {
              T1 = data;
          $("#meta1").append("<h3>" + table1_name + "</h3>");
          $("#meta1").append(tree(data.dimensions));
        });

        jQuery.getJSON("r/get_meta.r", {"table":table2_name}, 
            function(data) {
          $("#meta2").append("<h3>" + table2_name + "</h3>");
          $("#meta2").append(tree(data.dimensions));
        });


        $("#linkform").submit(function(e) {
          var json = this.link.value;
          $.ajax({
            url: "r/link.r",
            dataType: 'json',
            data: {"link":json},
            type: "POST",
            success: function(data) {
              if (data.fail) {
                $("#linkresult").html("Creation of table failed: '" + 
                  data.message + "'");
              } else {
                $("#linkresult").html("<a href=\"table.html?table=" + data + 
                  "\">Table successfully created</a>");
              }
            }
          });
          return false;
        });

      });
    </script>

  </head>

  <body>
    <header>
      <h1><a href="index.html">StatMine</a></h1>
      <nav>
        <ul>
          <li><a href="index.html">Tables</a></li>
        </ul>
      </nav>
    </header>

    <article>
    <div id="link2">
    </div>
	  <div id="link">
	  <input name="newtable" id="newtable" value="newtable"></input>
	  <table>
	     <thead>
			<tr>
				<th><div class="table">Table 1</th>
				<th><div class="table">Table 2</th>
			</tr>
		 </thead>
		 <tbody>
	     <tr class="dimension droppable">
			<td><div class="dimension" data-dim="dim1" data-value="jaar">Jaar</div></td>
			<td><div class="dimension" data-dim="dim2" data-value="jaar">Jaar</div></td>
			<td><i class="icon-remove"></i></td>
		 </tr>
		 <tr class="categories">
		   <td colspan="3" >
			 <table class="table table-condensed">
				<tr class="category droppable">
				  <td> <div class="category draggable" data-name="cat1">cat1 </div></td>
				  <td> <div class="category draggable" data-name="cat2">cat2 </div></td>
				  <td></td>
				</tr>
				<tr class="category droppable">
				  <td> <div class="category draggable" data-name="cat1">cat1 </div></td>
				  <td> </td>
				  <td></td>
				</tr>
				<tr class="category droppable">
				  <td> <div class="category draggable" data-name="cat1">cat1 </div></td>
				  <td> <div class="category draggable" data-name="cat2">cat2 </div></td>
				  <td></td>
				</tr>
			  </table>
		   </td>
		 </tr>
		 </tbody>
	  </table>
	  </div>
 
      <h2>Link tables</h2>

      <form id="linkform">
        <p>
          Link:<br>
          <textarea name="link" id="linkdump" rows="20" cols="80">
          </textarea>
          <br>
          <input type="submit" value="Link">
        </p>
        <p id="linkresult"></p>
      </form>
      <h2>Meta data of tables that should be linked</h2>
      <div id="meta1">
      </div>
      <div id="meta2">
      </div>
    </article>

    <footer>
    </footer>

  </body>
</html>


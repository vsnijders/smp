<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>StatMine</title>

    <!-- webpage icon -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="images/favicon2.png" type="image/png" />

    <!-- jQuery includes -->
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <link type="text/css" href="css/smoothness/jquery-ui-1.9.1.custom.min.css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.getUrlParam.js"></script>
    
	<!-- bootstrap includes -->
    <link type="text/css" href="js/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <script type="text/javascript" src="js/bootstrap/js/bootstrap.min.js"></script>

	
	<script type="text/javascript" src="js/link.js"></script>

    <!-- styling -->
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,300italic,400' rel='stylesheet' type='text/css'/>
    <link type="text/css" href="css/statmine.css" rel="stylesheet" />
    <link type="text/css" href="css/link.css" rel="stylesheet" />

    <!-- scripting -->
    <script type="text/javascript">
      
      var T1 = null;

      $(function() {

        var table1_name = $(document).getUrlParam("table1");
        var table2_name = $(document).getUrlParam("table2");

        jQuery.getJSON("r/gen_link.r", {"table1":table1_name, "table2": table2_name}, 
            function(data) {
              $("#linkdump")
                .text(JSON.stringify(data))
                .hide()
                ;
              Link.render("#link", data)
        });

        $("#linkform").submit(function(e) {
          //var json = this.link.value;
          var json = Link.getData("#link");
          console.log(json);
          $.ajax({
            url: "r/link.r",
            dataType: 'json',
            data: {"link":JSON.stringify(json)},
            type: "POST",
            success: function(data) {
              if (data.fail) {
                $("#linkresult").html("Creation of table failed: '" + 
                  data.message + "'");
              } else {
                $("#linkresult").html("<a href=\"visualise.html?table=" + data + 
                  "\"><i class='icon-eye-open'></i>Table successfully created</a>");
              }
            }
          });
          return false;
        });

      });
    </script>

  </head>

  <body>
    <header>
      <h1><a href="index.html">StatMine</a></h1>
      <nav>
        <ul>
          <li><a href="index.html">Tables</a></li>
        </ul>
      </nav>
    </header>

    <article>
      <h2>Link tables</h2>
      <p>The following tables can be linked on the following dimensions:</p>
      <form id="linkform">
      <div id="link">
      <label>Name of new table: <input name="newtable" id="newtable" value="linked.table"></input></label>
      <button class="btn" type="submit"><i class="icon-resize-horizontal"></i>Create</button>
      <p id="linkresult"></p>

      <table>
        <thead>
        <tr>
          <th><div class="table">Table 1</th>
          <th></th>
          <th><div class="table">Table 2</th>
        </tr>
       </thead>
     <tbody>
       <tr class="dimension">
          <td><div class="dimension draggable1"><i class="icon-list"></i><span class="dim">Jaar</span></div></td>
          <td><i class="icon-resize-horizontal"></i></td>
          <td><div class="dimension draggable2"><i class="icon-list"></i><span class="dim">Jaar</span></div></td>
          <td><a href="#" data-toggle="collapse" data-target=""><i class="icon-chevron-right"></i></a></td>
       </tr>
     <tr class="categories">
       <td colspan="3" >
        <div class="collapse">
         <table class="" style="width:100%">
            <tr class="category">
              <td> <div class="category draggable1">cat1 </div></td>
              <td><i class="icon-resize-horizontal"></i></td>
              <td> <div class="category draggable2">cat2 </div></td>
            </tr>
          </div>
          </table>
       </td>
     </tr>
     </tbody>
    </table>
    </div>
 
    <textarea name="link" id="linkdump" rows="20" cols="80" style="width:400px"> </textarea>
      </form>
    </article>

    <footer>
    </footer>

  </body>
</html>

